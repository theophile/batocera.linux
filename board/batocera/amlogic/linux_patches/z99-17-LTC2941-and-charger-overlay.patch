From 9b0daa5043748feb2a690c4ab997af14ddf43b9d Mon Sep 17 00:00:00 2001
From: theophile <chmeredith@gmail.com>
Date: Wed, 5 Oct 2022 19:15:20 -0500
Subject: [PATCH] dt overlays: add overlay for LTC2941 fuel gauge and
 gpio-charger

---
 arch/arm64/boot/dts/amlogic/overlay/Makefile  |  3 +-
 .../amlogic/overlay/meson-g12a-ltc2941.dts    | 38 +++++++++++++++++++
 2 files changed, 40 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm64/boot/dts/amlogic/overlay/meson-g12a-ltc2941.dts

diff --git a/arch/arm64/boot/dts/amlogic/overlay/Makefile b/arch/arm64/boot/dts/amlogic/overlay/Makefile
index 0f54911ce6f04..9c47f9e3fb591 100644
--- a/arch/arm64/boot/dts/amlogic/overlay/Makefile
+++ b/arch/arm64/boot/dts/amlogic/overlay/Makefile
@@ -29,7 +29,8 @@ dtbo-$(CONFIG_ARCH_MESON) += \
 	meson-g12a-gpio-poweroff.dtbo \
 	meson-g12a-gpio-shutdown.dtbo \
 	meson-g12a-ads1015.dtbo \
-	meson-g12a-pwm-backlight.dtbo
+	meson-g12a-pwm-backlight.dtbo \
+	meson-g12a-ltc2941.dtbo
 
 scr-$(CONFIG_ARCH_MESON) += \
 	meson-fixup.scr
diff --git a/arch/arm64/boot/dts/amlogic/overlay/meson-g12a-ltc2941.dts b/arch/arm64/boot/dts/amlogic/overlay/meson-g12a-ltc2941.dts
new file mode 100644
index 0000000000000..d243230ea891f
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/overlay/meson-g12a-ltc2941.dts
@@ -0,0 +1,38 @@
+/dts-v1/;
+/plugin/;
+
+#include <dt-bindings/gpio/gpio.h>
+#include <dt-bindings/gpio/meson-g12a-gpio.h>
+
+/ {
+compatible = "radxa,zero", "amlogic,g12a";
+
+        fragment@0 {
+                target = <&i2c3>;
+                __overlay__ {
+                        #address-cells = <1>;
+                        #size-cells = <0>;
+                        status = "okay";
+                        fuelgauge: fuelgauge@64 {
+                                compatible = "lltc,ltc2941";
+                                status = "okay";
+                                reg = <0x64>;
+                                lltc,resistor-sense = <25>;
+                                lltc,prescaler-exponent = <6>;
+                                power-supplies = <&usb_charger>;
+                        };
+                };
+        };
+
+        fragment@1 {
+                target-path = "/";
+                __overlay__ {
+                        usb_charger: charger {
+                                compatible = "gpio-charger";
+                                charger-type = "usb-sdp";
+                                charge-status-gpios = <&gpio GPIOH_7 (GPIO_ACTIVE_HIGH)>;
+                        };
+                };
+        };
+
+};
